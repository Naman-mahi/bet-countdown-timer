<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Video Recording</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
  <div class="container mt-5">
    <div class="row justify-content-center">
      <div class="col-md-6">
        <p>
          Click the "Start Recording" button to begin video recording for up to 2 minutes.
          You can stop recording by clicking the "Stop Recording" button. The "Download"
          button will download the recorded video.
        </p>
        <br />

        <div id="recordingContainer" class="text-center d-none mb-3">
          <h2 id="countdown"></h2>
        </div>

        <div id="videoContainer" class="d-none">
          <video id="preview" width="320" height="240" autoplay muted></video>
        </div>

        <div class="text-center mb-3">
          <button id="startButton" class="btn btn-primary">Start Recording</button>
          <button id="stopButton" class="btn btn-danger d-none">Stop Recording</button>
          <a id="downloadButton" class="btn btn-success d-none">Download</a>
        </div>

        <div class="bottom">
          <pre id="log"></pre>
        </div>
      </div>
    </div>
  </div>

  <!-- Bootstrap JS and Custom Script -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    let preview = document.getElementById("preview");
    let startButton = document.getElementById("startButton");
    let stopButton = document.getElementById("stopButton");
    let downloadButton = document.getElementById("downloadButton");
    let logElement = document.getElementById("log");

    let countdownElement = document.getElementById("countdown");
    let recordingContainer = document.getElementById("recordingContainer");
    let videoContainer = document.getElementById("videoContainer");

    let mediaRecorder;
    let recordedChunks = [];
    let isRecording = false;

    function log(msg) {
      logElement.innerHTML += `${msg}\n`;
    }

    function startCountdown() {
      let count = 3;
      countdownElement.textContent = count;
      let countdownInterval = setInterval(() => {
        count--;
        countdownElement.textContent = count;
        if (count <= 0) {
          clearInterval(countdownInterval);
          startRecording();
        }
      }, 1000);
    }

    function startRecording() {
      navigator.mediaDevices.getUserMedia({
        video: true,
        audio: true,
      }).then((stream) => {
        preview.srcObject = stream;
        mediaRecorder = new MediaRecorder(stream);

        mediaRecorder.ondataavailable = (event) => {
          if (event.data.size > 0) {
            recordedChunks.push(event.data);
          }
        };

        mediaRecorder.onstop = () => {
          let recordedBlob = new Blob(recordedChunks, { type: "video/webm" });
          preview.src = URL.createObjectURL(recordedBlob);
          downloadButton.href = preview.src;
          downloadButton.download = "RecordedVideo.webm";

          log(
            `Successfully recorded ${recordedBlob.size} bytes of ${recordedBlob.type} media.`,
          );
        };

        mediaRecorder.start();
        isRecording = true;
        startButton.classList.add("d-none");
        stopButton.classList.remove("d-none");
        downloadButton.classList.add("d-none");
        recordingContainer.classList.remove("d-none");
        videoContainer.classList.remove("d-none");

        setTimeout(stopRecording, 120000); // Stop recording after 2 minutes
      }).catch((error) => {
        log(`Error accessing media devices: ${error}`);
      });
    }

    function stopRecording() {
      if (isRecording) {
        mediaRecorder.stop();
        isRecording = false;
        startButton.classList.remove("d-none");
        stopButton.classList.add("d-none");
        downloadButton.classList.remove("d-none");
        recordingContainer.classList.add("d-none");
        videoContainer.classList.add("d-none");
      }
    }

    startButton.addEventListener("click", () => {
      startCountdown();
    });

    stopButton.addEventListener("click", () => {
      stopRecording();
    });
  </script>
</body>
</html>
